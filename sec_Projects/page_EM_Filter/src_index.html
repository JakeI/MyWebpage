<html lang="de">
<head>
  <title>Electromagnetic Filter</title>

  <meta name="author" content="Jochen K. Illerhas (called JakeI)" />
  <meta name="keywords" content="Blog, JavaScript, Computer Science, Machine Learning" />
  <meta name="description" content="My personal webpage" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="shortcut icon" type="image/x-icon" href="../../icons/icon.ico" />

  <meta charset="UTF-8" />

  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Kalam" />
  <link rel="stylesheet" type="text/css" href="../../style/default.css" />

</head>
<body class="page testpage">
    <h1 style="font-size:44pt;text-align:center;">Electromagnetic Filter</h1>
    <p>
      A common topic in Highschool physics is the electromagnetic velocity filter/selector (
      <a href="https://en.wikipedia.org/wiki/Wien_filter">Wienfilter</a>). It turns out that
      the reason it works has only little to do with what students are thought.
    </p>
    <p>
      <em>Disclaimer:</em> I'm not an export on any of this. This has been reviewed
      by a hand full of people but other than that the mathematical result below remains untested.
      I greatly appreciate all comments!
    </p>
    <img src="Filter_Misconception.svg" width="450px" draggable="true" align="right"
      style="margin-left: 10px;" />
    <p>
      Electromagnetic velocity filters have applications in
      <a href="https://en.wikipedia.org/wiki/Mass_spectrometry">mass-spectrometry</a>
      (=in trying to classify charged particles such as Ions
      based on their mass-charge-ratio). It is possible to
      produce streams of such particles. Unfortunately, particle in such
      streams have varying speeds but the method used for the actual
      classification requires the incoming stream of particles to have a
      constant and known velocity. Electromagnetic velocity Filters are used to
      deflect particles of unwonted speeds and only let particles witch already have
      a specific speed <em>v&#773;</em> pass to the next step in the classification process.
      A simple illustration of a EM Filter can be seen on the right.
      All relative location given (left, right, horizonatlly, ...) are in refrence to this
      illustration (Note: you could turn the entire setup upside down without effecting how it works).
      In the setup a homogeneous magnetic field <em>⃗B</em> points into the
      drawing plain and a homogeneous electric field <em>⃗E</em> is perpendicular to the magnetic field. The
      steam of particles is sent in on the left and (initially) the particles velocities are
      at right angles to both the magnetic and the electric field. The electromagnetic force on each particle
      is the sum of the electric and magnetic forces (<em>⃗F<sub>m</sub></em> and <em>⃗F<sub>e</sub></em>
      respectively) witch are aligned as shown above. So since the magnitude of the magnetic
      force depends on the magnitude of the velocity, it's obvious that there has to be some
      speed <em>v&#773;</em> such that electric and magnetic forces cancel perfectly.
      In this case the net force on the particle is zero so it will not be deflected
      but move on a horizontal line.
      For particles moving at a speed other than <em>v&#773;</em> there must be a net force
      hence they are deflected thus filtered out from the particle stream. Solving the described equation
      yields that the critical speed is <em>v&#773; = E/B</em> (<em>B</em> and <em>E</em> are the magnitudes of the magnetic
      and electric fields respectively and the full equation is knowen as the Wien Condition
      <a target="_blank" href="https://books.google.de/books?id=oQccAseXmtcC&lpg=PA3&ots=3vr3qyEYs-&dq=cycloide%20wien%20filter&pg=PA2#v=onepage&q=cycloide%20wien%20filter&f=false">
        [see here]</a>).
      <a href="https://www.didaktik.physik.uni-muenchen.de/elektronenbahnen/en/b-feld/anwendung/geschwindigkeitsfilter.php">
        A full derivations can be found online.
      </a>
    </p>
    <p>
      As previously stated this is the explanation you will likely find right away
      when researching the topic. At first glance it seams reasonable and when I was
      introduced to the problem (in Highschool) I was satisfied with this.
      But recently my attention was drawn back to the problem and I realized that this
      explanation is deeply floored.
    </p>
    <img src="Filter.svg" width="450px" draggable="true" align="left"
      style="margin-right: 10px;" />
    <p>
      In fact the explanation is only valid for the very fist moment. This is easy to
      understand when looking at edge cases. Suppose the particle placed in the filter has no
      initial velocity (it is <em>0</em>). At fist, it won't be affected by the magnetic field. So the only
      force acting on the particle will be the eclectic force. According to the explanation given
      above this will cause the particle to move on a vertical line. Here is the problem though,
      moving on a vertical line means that the velocity is non-zero and the magnetic force has
      to be consider. This magnetic force will be perpendicular to the magnetic field and
      the velocity, hence the particle velocity will be in the plane drawn on the left and can
      be described using two coordinates <em>⇒ ⃗v := (v<sub>x</sub>, v<sub>y</sub>, 0)<sup>T</sup></em>.
      As there is no way the particle will ever leaf the xy-Plain, the z components of vilocity and
      position are just <em>0</em>. To simplify the equations the z components will be
      dropped were ever convenient (they are implicitly considered to be <em>0</em>).
      Suppose the Electric Field <em>⃗E</em> is given by <em>(0, -E, 0)<sup>T</sup></em> and the
      Magnetic Field <em>⃗M</em> by <em>(0, 0, B)<sup>T</sup></em>. For simplicity, define the
      constants <em>&omega; := qB/m</em> (<em>q</em> is the charge of the particle,
      <em>&omega;</em> is the
      <a href="https://en.wikipedia.org/wiki/Cyclotron_resonance#Cyclotron_frequency">
        Cyclotron angular frequency</a>) and
      <em>v&#773; := E/B</em> (just as above). Than the definition of the Electromagnetic force can be simplified
      to the following set of linked differential equations:
    </p>
    <img src="EM-Sys.svg" alt="\vec{F}_{EM} = q( \vec{E} + \vec{v} \times \vec{B})
                                \Leftrightarrow
                                \underbrace{ \left( \begin{matrix} \dot{v}_x \\ \dot{v}_y \end{matrix} \right) }_{\dot{\vec{v}}} =
                                \underbrace{ \left( \begin{matrix} 0 & -\omega \\ \omega & 0\end{matrix} \right) }_{A}
                                \underbrace{ \left( \begin{matrix} v_x \\ v_y \end{matrix} \right ) }_{\vec{v}} +
                                \underbrace{ \left( \begin{matrix} 0 \\ -\omega \bar{v} \end{matrix} \right ) }_{\vec{b}}" />
    <p>
      This can be solved using the
      <a href="https://en.wikipedia.org/wiki/Matrix_exponential">matrix-exponential</a>
      <em>e<sup>At</sup></em> (Note: <em>e<sup>At</sup> = ℒ<sub>s</sub><sup>-1</sup>{(sI - A)<sup>-1</sup>}</em>
      were <em>ℒ<sub>s</sub><sup>-1</sup></em> is the inverse
      <a href="https://en.wikipedia.org/wiki/Laplace_transform">Laplace Transform</a> with respect to <em>s</em>, and
      <em>I</em> represents a 2⨯2 identity matrix). Multiplying both sides with <em>e<sup>At</sup></em> applying
      the product rule, integrating both sides and solving for <em>⃗v</em> show that a general solution is:
    </p>
    <img src="general-sol.svg" alt="$$\vec{v}(t) = e^{-At} (A^{-1} e^{At} \vec{b} + \vec{c}) =
                                      \left( \begin{matrix}
                                      c_x \cos(\omega t) - c_y \sin(\omega t) + \bar{v} \\
                                      c_x \sin(\omega t) + c_y \cos(\omega t)
                                      \end{matrix} \right )$$" />
    <p>
      Here <em>⃗c = (c<sub>x</sub>, c<sub>y</sub>)<sup>T</sup></em> is a constant of integration.
      Defining the initial condition <em>⃗v(0) := (u<sub>x</sub>, u<sub>y</sub>)<sup>T</sup></em> yields that:
    </p>
    <img src="v-funcs.svg" alt="\begin{matrix}
                                v_x(t) & = & u_x \cos(\omega t) - u_y \sin(\omega t) + \bar{v} \left( 1 - \cos(\omega t) \right) \\
                                v_y(t) & = & u_x \sin(\omega t) + u_y \cos(\omega t) - \bar{v} \sin(\omega t)
                                \end{matrix}" />
    <p>
      Integrating and requiring that <em>x(0) = x<sub>0</sub></em> and
      <em>y(0) = y<sub>0</sub></em>, results in the particles trajectory:
    </p>
    <img src="trajectory.svg" alt="\begin{matrix}
                                    x(t) & = & \frac {1}{\omega} \left( u_x \sin(\omega t) + u_y \left( \cos(\omega t) - 1 \right) +
                                    \bar{v} \left( \omega t - \sin( \omega t )  \right)  \right) + x_0 \\
                                    y(t) & = & \frac{1}{\omega} \left( u_x \left( 1 - \cos(\omega t) \right ) + u_y \sin(\omega t) +
                                    \bar{v} \left( \cos(\omega t) - 1 \right )\right) + y_0
                                    \end{matrix}" />
    <img src="trajectroy-plot-initial.svg" width="500px" align="right"/>
    <p>
      Let's considerer an electric field <em>E</em> of <em>30kV/m</em>,
      a magnetic field <em>M</em> of <em>300mT</em>,
      and an electron (mass <em>m = 9.109 10<sup>-31</sup>kg</em>,
      charge <em>q = -1.602 10<sup>-19</sup>C</em>). If the initial conditions
      <em>x<sub>0</sub></em>, <em>y<sub>0</sub></em> and <em>u<sub>y</sub></em> are
      set to <em>0</em>, the effects of <em>u<sub>x</sub></em> can be studied.
      There are plots of the trajectories for <em>u<sub>x</sub> = 0</em> (top),
      <em></sup>u<sub>x</sub> = 1 10<sup>5</sup> m/s = v&#773; = E/B</em> (middle), and
      <em>u<sub>x</sub> = 5 10<sup>5</sup> m/s = 5 v&#773;</em> (bottom) on the right.
      The animation below shows the same for <em>u<sub>x</sub></em>
      taken form a range form <em>0</em> to <em>5 v&#773;</em>.
      Unsurprisingly, this model still predicts that particles with
      <em>u<sub>x</sub> = v&#773;</em> will move on a horizontal line (middle plot).
      What's new is that slow particles (top plot) move on a cycloid curve
      and fast particles on a prolate trochoid.
      It is nice to notice, that the trajectories are periodic (with a
      period of  <em>| 2&pi;/&omega; |</em>) and it will be sufficient to considered
      a single period in further discussions. The main Problem with this trajectory is
      that the electron is not deflected in any of these cases. In fact, each of these
      trajectories is very close to a straight line because the range of y
      is very small compared to that of x (Especially because the range of y
      is constant after one period, but the range of x increases over time).
    </p>
    <center>
      <video width="95%" autoplay loop>
        <source src="trajectory-plot-ani.mp4" type="video/mp4">
        Your browser doesn't support HTML5 video. Go get a real browser
      </video>
    </center>
    <p>
      It is neat that these trajectories can be constructed as
      <a href="https://en.wikipedia.org/wiki/Roulette_(curve)">Roulettes</a>,
      specifically as <a href="https://en.wikipedia.org/wiki/Trochoid">trochoides</a>
      (the path traced by a fixed point on a circle rolling on a straight line).
      For <em>u<sub>x</sub> = 0</em> the trajectory turns out to be a common
      trochid (also called a cycloid). The Animation below shows how this curve
      could be constructed as a roulette.
    </p>
    <center>
      <video width="95%" autoplay loop>
        <source src="construct_trajectory-cycloide.mp4" type="video/mp4">
        Your browser doesn't support HTML5 video. Go get a real browser
      </video>
    </center>
    <div style="float:right;">
      <video width="550px" autoplay loop>
        <source src="construct_trajectory-trocoide.mp4" type="video/mp4">
        Your browser doesn't support HTML5 video. Go get a real browser
      </video>
    </div>
    <p>
      Similarly, the trajectory for <em>u<sub>x</sub> = 5v&#773;</em> is a
      a prolate trochid. The animation on the left rolls a small circle on
      a straight line, than traces a fixed point on the circle but outside its
      boundary to construct the particle trajectory.
    </p>
    <p>
      Trochids are a superposition of linear and circular motion. Electric fields
      generally cause linear motion while magnetic fields cause circular motion.
      It seams reasonable, that a superposition of electric and magnetic fields
      would cause a particle to move on a path which is a superposing of linear
      and circular motion. So this trajectory isn't that surprising after all.
    </p>
    <img src="alpha-time.svg" width="500px" align="left" />
    <p>
      But if the filter dose not deflect any particles regardless of speed,
      how dose it work? The short answer is it dose not. The filter dose not
      filter out all particles with unwanted speeds. But it allows viewer particles
      to pass if they have the wrong <em>u<sub>x</sub></em>.
    </p>
    <p>
      Looking at the trajectories above shows that there are times when the electron moves
      on a horizontal line. If the Electromagnetic fields where switched of/ended exactly
      at a maximum y value (witch happens to be the time when it is momentarily
      moving on a horizontal line) the electron would keep flying in the horizontal
      direction and be a part of the filtered particle stream. Fortunately times
      when the electron moves horizontally are quite rare.
      Lets considerer all particles
      deflected by more than <em>±5°</em> to be successfully sorted out. Sticking to the
      example from above the angle <em>&alpha; = arg{v<sub>x</sub> + iv<sub>y</sub>}</em>,
      which corresponds to the slope of the tangent line to the trajectory, can
      be plotted against time (see the solid line (and the left y-axis) in the plot on the
      left or the animation below). The <em>±5°</em> range and the curves
      intersections with it's boundary's
      have been marked in the plot. This clearly shows that the
      middle <em>u<sub>x</sub> = v&#773;</em> curve is always in the <em>±5°</em> range.
      On the other hand, for <em>u<sub>x</sub></em> other than <em>v&#773;</em> there are only
      small time intervals in which particles are moving horizontally. At some point
      the EM fields will end because the filter has a finite size (this assumption may
      not be very close to real magnetic fields which decrees in strength but don't have a clear
      boundary but it is the best one can do without being specific about the dimensions of the filter)
       but at what point
      in the trajectory's period this will occur is basically random. So if <em>r</em> is
      the ratio of time the trajectory spends in the <em>±5°</em> range to it's period,
      the probability of any given electron ending up in the output particle stream should be
      <em>r</em>.
    </p>
    <p>
      Particles with the wrong initial speed not being sorted out
      would not be a problem if the particles were moving at <em>v&#773;</em>
      when ever they moved horizontally (so if the setup accelerated them to the desired speed).
      To see if this is so the
      plot on the left and the animation below show a dashed line which represents the magnitude of the particles
      velocities (and corresponds to the right y-axis). Unfortunately the plots clearly show that the electrons
      do not simultaneously move on a horizontal line and at <em>v&#773;</em>.
      So the output particle stream cannot be expected to consist only of particles
      moving at <em>v&#773;</em> instead all velocities are to be expected (assuming that
      the input stream also contained particles moving at all possible velocities),
      but there will be significantly viewer particles moving at undesired speeds
      than at the desired speed <em>v&#773;</em>.
    </p>
    <center>
      <video width="95%" autoplay loop>
        <source src="alpha_time_ani.mp4" type="video/mp4">
        Your browser doesn't support HTML5 video. Go get a real browser
      </video>
    </center>
    <p>
      Let's express <q>significantly viewer particles moving at undesired speeds
      than at the desired speed <em>v&#773;</em></q> in a more rigorous way.
    </p>
    <img src="prop-distrib.svg" align="right" width="500px" />
    <p>
      The ratio/probability <em>r</em> as defined above can be considered to be a
      probability distribution <em>r(u<sub>x</sub>)</em>. A plot of <em>r</em>
      vs <em>u<sub>x</sub></em> is on the right. So the solid orange line represents
      the probability that a particle with <em>u<sub>x</sub></em> will be deflected by
      <em>±5°</em> or less. Clearly, there is one spike around <em>v&#773;</em> which
      will always pass through. For any other <em>u<sub>x</sub></em> chances are they
      will be sorted out. Since the <em>±5°</em> range was an arbetrary choise, the
      dashed lines show the effects of making different choices. The result is what was to be
      expected: A narrower definition of &quot;moving horizontally&quot; means that
      less particles of the wrong speed pass though the filter.
    </p>
    <p>
      So my conclusion is:
    </p>
    <ul>
      <li>Highschool students are routinely lied to about how EM-velocity filters work.</li>
      <li>Particles in the filter move on trochoid shaped trajectories.</li>
      <li>
        The probability of a particle to just happen to move horizontally when it
        reaches the edge of the EM-field is very low if the particle started of
        with an horizontal speed other than <em>E/B</em>. So in most cases
        particles will be sorted out successfully and correctly.
      </li>
      <li>
        This assumes that the EM field will just end at some point. (Note that
        a real EM-field will decrease in strength and become less homogeneous
        before it is to weak to have any effect. So it doesn't actually have a boundary
        at which it could &quot;end&quot;)
      </li>
    </ul>


</body>
</html>
